package com.easyshopping.service.impl;
 import java.util.List;
import javax.annotation.Resource;
import com.easyshopping.Page;
import com.easyshopping.Pageable;
import com.easyshopping.dao.ProductNotifyDao;
import com.easyshopping.entity.Member;
import com.easyshopping.entity.Product;
import com.easyshopping.entity.ProductNotify;
import com.easyshopping.service.MailService;
import com.easyshopping.service.ProductNotifyService;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
@Service("productNotifyServiceImpl")
public class ProductNotifyServiceImpl extends BaseServiceImpl<ProductNotify, Long>implements ProductNotifyService{

@Resource(name = "productNotifyDaoImpl")
 private ProductNotifyDao productNotifyDao;

@Resource(name = "mailServiceImpl")
 private MailService mailService;


@Resource(name = "productNotifyDaoImpl")
public void setBaseDao(ProductNotifyDao ProductNotifyDao){
    super.setBaseDao(ProductNotifyDao);
}


@Transactional(readOnly = true)
public Long count(Member member,Boolean isMarketable,Boolean isOutOfStock,Boolean hasSent){
    return productNotifyDao.count(member, isMarketable, isOutOfStock, hasSent);
}


@Transactional(readOnly = true)
public boolean exists(Product product,String email){
    return productNotifyDao.exists(product, email);
}


@Transactional(readOnly = true)
public Page<ProductNotify> findPage(Member member,Boolean isMarketable,Boolean isOutOfStock,Boolean hasSent,Pageable pageable){
    return productNotifyDao.findPage(member, isMarketable, isOutOfStock, hasSent, pageable);
}


public int send(Long[] ids){
    List<ProductNotify> productNotifys = findList(ids);
    for (ProductNotify productNotify : productNotifys) {
        mailService.sendProductNotifyMail(productNotify);
        productNotify.setHasSent(true);
        productNotifyDao.merge(productNotify);
    }
    return productNotifys.size();
}


}